{% extends "rutas/base.html" %}
{% block title %}Clientes{% endblock %}

{% block content %}
<h2>Clientes</h2>

<p>
  <a href="{% url 'crm:crear_cliente' %}" class="btn btn-primary">
    ‚ûï Crear cliente
  </a>
</p>

<!-- üëá WRAPPER para evitar que la tabla se salga del marco -->
<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Tel√©fono</th>
        <th>Email</th>
        <th>Comuna</th>
        <th>Direcci√≥n</th>
        <th>Kilos comprados</th>
        <th>Segmento</th>
        <th>Acciones</th>
      </tr>
    </thead>

    <tbody>
    {% for c in clientes %}
      <tr>
        <td>{{ c.id }}</td>
        <td>{{ c.nombre }}</td>
        <td>{{ c.telefono }}</td>
        <td>{{ c.email }}</td>
        <td>{{ c.comuna }}</td>
        <td>{{ c.direccion }}</td>
        <td>{{ c.gasto_total|default:0|floatformat:0 }} kg</td>
        <td>
          <span class="flag flag-{{ c.segmento_color }}">
            {{ c.segmento }}
          </span>
        </td>
        <td>
          <div class="acciones">
            <a href="{% url 'crm:editar_cliente' c.id %}"
               class="btn btn-edit">
               Editar
            </a>

            <form method="post"
                  action="{% url 'crm:borrar_cliente' c.id %}"
                  class="inline-form">
              {% csrf_token %}
              <button type="submit"
                      class="btn btn-delete"
                      onclick="return confirm('¬øSeguro que quieres borrar este cliente?');">
                Borrar
              </button>
            </form>
          </div>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="9">No hay clientes.</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
